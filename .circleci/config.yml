version: 2

jobs:
    build:
        machine: true
            environment:
                - GIT_COMMIT_DESC: git log --format=oneline -n 1 $CIRCLE_SHA1
        steps:
            - checkout
            - run:
                name: "Build Docker Image"
                command: "docker build -t ingalls/hecate:$CIRCLE_BRANCH ."
            - run: 
                name: "Tests"
                command: "docker run --name hecate ingalls/hecate:$CIRCLE_BRANCH -e COMMITMSG=$GIT_COMMIT_DESC -e GITHUB_TOKEN=$GITHUB_TOKEN"
